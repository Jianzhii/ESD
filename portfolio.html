<!DOCTYPE html>
<html>

<head>

    <title>Stonks Exchange</title>

    <!-- CSS (Use this section if you need to) -->

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
    integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
    crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
    integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
    crossorigin="anonymous"></script>
    <script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>


        <!-- jQuery first, then Popper.js, then Bootstrap JS
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
        integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script> -->

    <style>
        /* YOUR CSS CODE GOES HERE */

        #down{
            color: red;
        }

        h4 {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 30px;
        }

        #main {
            margin: auto;
            width: 80%;
        }

        .flex-container {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        #warning{
            justify-content: center;
        }

        #g_change {
            color: green;
        }

        #l_change{
            color: red;
        }

        .symbol:hover {
            color: blue;
            cursor: pointer ;

        }

        h1 {
            text-align: center;
            margin: 15px ;
            font-weight: bold ;
        }

        h2 {
            text-align: center ;
            font-weight: bold ;
        }
        
    </style>

</head>

<body>
    <!-- YOUR CODE GOES HERE -->

        <div class="container" id="main">
            <h1 id="welcome">Welcome to Stonks Exchange, </h1>
            <div class="container">
                <div class="row">
                    <div class="col-sm-5">
                        <div class="card bg-light mb-3 h-100">
                            <div class="card-header" style='font-size:26px ; text-align: center;'>
                                <i class="fas fa-user-circle" style='font-size:36px'></i>
                                Personal Information</i>
                            </div>
                            <div class="card-body">
                              <p class="card-text"></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-7">
                        <div class="card bg-light mb-3 h-100">
                            <div class="card-header" style='font-size:26px ; text-align: center'>
                                <i class='fas fa-piggy-bank' style='font-size:36px'></i>Your Wallet
                            </div>
                            <div class="card-body">
                              <p class="card-text" id="left">
                                    Amount Left: $
                              </p>
                              <p class="card-text" id="spent">
                                    Amount Spent: $
                              </p>
                            </div>
                        </div>
                    </div>
                </div>

            <div class="container">
                <h2 style='text-align: center ; margin: 20px'>Your Stocks</h2>
                <table class="table" id="stocks">
                    <thead class="thead-light">
                      <tr>
                        <th scope="col">S/N</th>
                        <th scope="col">Name of Stock</th>
                        <th scope="col">Price of Stock</th>
                        <th scope="col">Quantity of Stock</th>
                      </tr>
                  </table>
        </div>
        </div>
      

      <script>
        
        $(async() => {     
            var user_id = 'Apple Tan'
            var userprofileURL = "http://localhost:5008/userprofile/" + user_id; 

            try {
                const response =
                await fetch(
                    userprofileURL, {
                        method: 'GET'
                    }
                );

                const result = await response.json();
                console.log(result)
                if (response.status === 200) {
                    var name = result.results.data.profile_result.profile.name
                    console.log(name)
                    $('#welcome').append(name)

                    var balance = result.results.data.funds_result.fund.balance
                    var spent = result.results.data.funds_result.fund.spent
                    $('#left').append(balance)
                    $('#spent').append(spent)

                    var rows = ""
                    var stocks = result.results.data.portfolio_result.stocks

                    for (const stock of stocks) {
                        eachRow = "<td>" + stock.stock_id + "</td>" +
                                  "<td>" + stock.price + "</td>" +
                                  "<td>" + stock.quantity + "</td" ;
                        rows += "<tbody><tr>" + eachRow + "</tr></tbody>"
                    }

                    $('#stocks').append(rows) ;
                }

                else if (response.status == 404) {
                    showError(result.message) ;
                } else {
                    throw response.status ;
                }
                
            } catch (error) {
                showError
                ('There is a problem retrieving your portfolio, please try again later.<br />' + error); 
            }
        });

          function showError(message) {
            $('#error').append("<label style='color:red; text-align:center'>"+message+"</label>");
          };
          
      </script>


</body>

</html>